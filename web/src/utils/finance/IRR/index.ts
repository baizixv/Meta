import { binarySearch } from '@/utils/common/math'
// æ¦‚å¿µï¼šIRRï¼ŒNPVï¼ŒçŽ°å€¼PVï¼Œç»ˆå€¼FVï¼ŒçŽ°é‡‘æµï¼Œ
// åˆ©çŽ‡ï¼Œåä¹‰åˆ©çŽ‡ï¼ŒçœŸå®žåˆ©çŽ‡ï¼Œå£°ç§°åˆ©çŽ‡ï¼ŒæŠ˜çŽ°çŽ‡ï¼Œå›žæŠ¥çŽ‡ï¼Œæœºä¼šæˆæœ¬ï¼Œè´´çŽ°çŽ‡
// åˆ©ç”¨äºŒåˆ†æ³•ï¼Œè¿›è¡Œé€¼è¿‘è¿‘ä¼¼æ±‚è§£
export const calculateIRR = (cashFlows: number[]) => {
  const guessRate = binarySearch(
    {
      low: -10000, // åˆå§‹åŒ–ä¸‹ç•Œ
      high: 10000, // åˆå§‹åŒ–ä¸Šç•Œ
      precision: 1e-6,
    },
    (rate: number) => {
      let npv = 0 // å‡€çŽ°å€¼
      for (let i = 0; i < cashFlows.length; i++) {
        // æ ¹æ®IRRçš„çŒœæµ‹å€¼è®¡ç®—å‡€çŽ°å€¼,
        // IRR: èµ„é‡‘æµå…¥çŽ°å€¼æ€»é¢ä¸Žèµ„é‡‘æµå‡ºçŽ°å€¼æ€»é¢ç›¸ç­‰ã€å‡€çŽ°å€¼ç­‰äºŽé›¶æ—¶çš„æŠ˜çŽ°çŽ‡ï¼›
        npv += cashFlows[i] / Math.pow(1 + rate, i)
      }
      // è¯•ç®—æ³•è®¡ç®—IRRæ—¶ï¼Œå¦‚æžœç”¨è¯•ç®—çš„åˆ©çŽ‡ç®—å‡ºæ¥çš„å‡€çŽ°å€¼å¤§äºŽç­‰äºŽ0ï¼Œè¯´æ˜Žè¿™ä¸ªåˆ©çŽ‡è¿˜æ˜¯æ¯”IRRå°ï¼Œåº”è¯¥å¾€ä¸Šæµ‹ã€‚
      // è¿™æ˜¯å› ä¸ºï¼ŒæŠ˜çŽ°çŽ‡ä¸ŽçŽ°å€¼æˆåæ–¹å‘å˜åŠ¨ï¼Œè€ŒIRRæ˜¯ä½¿å¾—å‡€çŽ°å€¼ç­‰äºŽ0çš„æŠ˜çŽ°çŽ‡ã€‚
      // å› ä¸ºæˆ‘å®šä¹‰çš„é€šç”¨äºŒåˆ†æ³•æ˜¯ç»“æžœå¤§äºŽ0ï¼Œè°ƒæ•´ä¸Šç•Œï¼Œæ‰€ä»¥è¿™é‡Œå–è´Ÿ
      return -npv
    }
  )

  return guessRate
}

const result = calculateIRR([-10000, 2500, 2500, 2500, 2500, 2500])
console.log(
  '%c Line:30 ðŸ… result',
  'font-size:18px;color:#f5ce50;background:#42b983',
  result
)
